<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Short Answer Exam</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .card-soft{border-radius:18px}
    .meta-row{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
      padding:10px 12px;border:1px solid rgba(0,0,0,.08);
      border-radius:14px;background:rgba(0,0,0,.02);
    }
    .meta-row .pill{
      display:inline-flex;gap:6px;align-items:baseline;
      padding:6px 10px;border-radius:999px;background:#fff;
      border:1px solid rgba(0,0,0,.08);font-size:13px;
    }
    .meta-row .k{color:#6c757d;font-size:12px}
    .meta-row .v{font-weight:800}

    .qtext{font-size:1.03rem;line-height:1.55;white-space:pre-wrap}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    textarea.form-control{border-radius:14px}
    .hint{min-height:18px}
    .small-muted{color:#6c757d;font-size:.9rem}
    .badge-soft{background:rgba(0,0,0,.08);color:#111}
    .answer-chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(0,0,0,.08);
      background:#fff;
      font-weight:700;
    }
  </style>
</head>

<body>
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-1">Short Answer Exam</h4>
      <div class="text-muted">Question <span id="qHeader">0/0</span></div>
    </div>
    <div class="text-end">
      <!-- increasing timer (no time-up per question) -->
      <div class="fs-5">Time: <span id="timeElapsed">0</span>s</div>
    </div>
  </div>

  <div class="card card-soft mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start gap-3 flex-wrap">
        <div>
          <h5 class="mb-1">Answer the question</h5>
          <div class="text-muted small">Type your final answer and press Submit. No auto-next until Submit.</div>
        </div>
        <div class="text-muted small text-end">
          Mouse/keyboard only
        </div>
      </div>

      <div class="meta-row mt-3">
        <span class="badge badge-soft" id="category">Exam</span>

        <span class="pill">
          <span class="k">Type</span>
          <span class="v">Short Answer</span>
        </span>

        <span class="pill ms-auto">
          <span class="k">Questions</span>
          <span class="v" id="totalText">5</span>
        </span>
      </div>

      <div class="mt-3">
        <div class="small-muted mb-1">Question</div>
        <div id="questionText" class="qtext">—</div>
      </div>

      <div class="mt-3">
        <label class="form-label small-muted" for="answerBox">Your answer</label>
        <textarea id="answerBox" class="form-control" rows="3" placeholder="Type your final answer here..."></textarea>

        <div class="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2">
          <div class="answer-chip mono">
            <span class="small-muted">Chars</span>
            <span id="charCount">0</span>
          </div>
          <div class="answer-chip mono">
            <span class="small-muted">RT</span>
            <span id="rtPreview">0</span> ms
          </div>
          <div class="ms-auto small text-muted">
            Tip: if it's a number, just enter the number.
          </div>
        </div>
      </div>

      <div class="mt-3 d-flex gap-2 flex-wrap">
        <button class="btn btn-outline-secondary btn-sm" id="btnClear" type="button">Clear</button>
        <button class="btn btn-dark btn-sm ms-auto" id="btnSubmit" type="button">Submit</button>
      </div>

      <div class="mt-2 small text-muted hint" id="hintText"></div>
    </div>
  </div>

  <div class="small text-muted">
    This page runs locally (no backend required). If you want DB logging like Task A/B, tell me your endpoint names and I’ll wire it.
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>

  const QUESTIONS = [
    {
      id: 1,
      text:
`1. Start with the number 30
2. Repeat until the number is less than 10:
2-1. If the number is a multiple of 10, divide it by 2
2-2. otherwise, subtract 7
3. What is the final number?`
    },
    {
      id: 2,
      text:
`1. Start with the number 10.
2. Repeat the following steps until the number is 10 or less:
- subtract 3 from the number
- if the new number is odd, add 1 to it.
- if the new number is even, do nothing
3. what is the final number?`
    },
    {
      id: 3,
      text: `Find the missing number: (2 ^ 4) + (15 // 2) = (___ * 3) + 1`
    },
    {
      id: 4,
      text: `Find the missing number: (100 / (2 * ___)) + (14 % 3) ^ 3 = 13`
    },
    {
      id: 5,
      text:
`Let the following be the rules for f(N):
- If N is 0, the result is 0
- Otherwise, the result is N%2 + f(N//2)
What is the value of f(13)?`
    }
  ];

  let idx = 0;
  const answers = [];

  let startedAt = 0;
  let timerId = null;

  const qHeader = document.getElementById('qHeader');
  const totalText = document.getElementById('totalText');
  const timeElapsed = document.getElementById('timeElapsed');
  const questionText = document.getElementById('questionText');
  const answerBox = document.getElementById('answerBox');
  const charCount = document.getElementById('charCount');
  const rtPreview = document.getElementById('rtPreview');
  const hintText = document.getElementById('hintText');

  const btnClear = document.getElementById('btnClear');
  const btnSubmit = document.getElementById('btnSubmit');

  totalText.textContent = String(QUESTIONS.length);

  function startTimerIncreasing(){
    if (timerId) clearInterval(timerId);
    startedAt = performance.now();
    timeElapsed.innerText = "0";
    rtPreview.innerText = "0";

    timerId = setInterval(() => {
      const elapsedSec = Math.floor((performance.now() - startedAt) / 1000);
      timeElapsed.innerText = String(elapsedSec);
      rtPreview.innerText = String(Math.max(0, Math.round(performance.now() - startedAt)));
    }, 200);
  }

  function resetAnswerBox(){
    answerBox.value = "";
    charCount.innerText = "0";
    hintText.innerText = "Type your answer, then press Submit.";
    answerBox.focus();
  }

  function renderQuestion(){
    if (idx >= QUESTIONS.length){
      renderDone();
      return;
    }
    const q = QUESTIONS[idx];
    qHeader.innerText = `${idx + 1} / ${QUESTIONS.length}`;
    questionText.textContent = q.text;
    resetAnswerBox();
    startTimerIncreasing();
  }

  function renderDone(){
    if (timerId) clearInterval(timerId);

    const rows = answers.map(a => {
      const q = QUESTIONS.find(x => x.id === a.id);
      const safeQ = (q?.text ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
      const safeA = String(a.answer ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
      return `
        <div class="card card-soft mb-3">
          <div class="card-body">
            <div class="text-muted small mb-1">Q${a.id}</div>
            <div class="qtext mb-2">${safeQ}</div>
            <div class="d-flex flex-wrap gap-2 align-items-center">
              <span class="answer-chip mono"><span class="small-muted">Answer</span> ${safeA}</span>
              <span class="answer-chip mono"><span class="small-muted">RT</span> ${a.rt_ms} ms</span>
            </div>
          </div>
        </div>
      `;
    }).join("");

    document.body.innerHTML = `
      <div class="container py-5">
        <h3 class="mb-2">Done.</h3>
        <div class="text-muted mb-4">Your responses are shown below.</div>
        ${rows || "<div class='text-muted'>No answers recorded.</div>"}
      </div>
    `;
  }

  answerBox.addEventListener("input", () => {
    charCount.innerText = String(answerBox.value.length);
  });

  btnClear.addEventListener("click", () => resetAnswerBox());

  answerBox.addEventListener("keydown", (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
      e.preventDefault();
      submitAnswer();
    }
  });

  btnSubmit.addEventListener("click", () => submitAnswer());

  function submitAnswer(){
    if (btnSubmit.disabled) return;
    const answer = answerBox.value.trim();
    if (!answer){
      hintText.innerText = "Please type an answer before submitting.";
      answerBox.focus();
      return;
    }

    btnSubmit.disabled = true;
    if (timerId) clearInterval(timerId);

    const rt_ms = Math.max(0, Math.round(performance.now() - startedAt));
    const q = QUESTIONS[idx];

    answers.push({ id: q.id, answer, rt_ms });


    idx += 1;
    btnSubmit.disabled = false;
    renderQuestion();
  }

  renderQuestion();
</script>
</body>
</html>
